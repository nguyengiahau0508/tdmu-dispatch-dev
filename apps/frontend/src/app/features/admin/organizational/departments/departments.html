<div class="departments">
  <div class="departments__header">
    <div class="header__group">
      <!-- <div class="header__title">
        <h2>Quản lý phòng ban</h2>
      </div> -->
      <div class="header__search">
        <input type="text" placeholder="Tìm phòng ban..." />
      </div>
      <div class="header__add">
        <button class="btn btn-primary" (click)="toggleCreateDepartment()">
          <span class="btn-icon">+</span>
          Thêm phòng ban
        </button>
      </div>
    </div>
    <div class="header__group header__group--block">
      <app-pagination [totalCount]="totalCount || 0" [pageOptions]="pageOptions" (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)" (orderChange)="onOrderChange($event)"></app-pagination>
    </div>
  </div>

  <div class="departments__main">
    @if (departments.length > 0) {
        <table class="departments__table">
          <thead>
           <tr>
             <th>ID</th>
             <th>Tên phòng ban</th>
             <th>Phòng ban cha</th>
             <th>Trạng thái</th>
             <th></th>
           </tr>
         </thead>

         <tbody>
           @for (department of departments; track department.id) {
           <tr class="department-row">
             <td>{{ department.id }}</td>
             <td class="department-name-cell">
               <div class="department-name">{{ department.name }}</div>
               <div class="department-description">{{ department.description || 'Không có mô tả' }}</div>
             </td>
             <td>{{ department.parentDepartment?.name || '-' }}</td>
             <td>
               <span class="status-badge status-active">Hoạt động</span>
             </td>
             <td class="row-actions">
               <div class="actions-menu">
                 <button class="menu-button" (click)="toggleMenu(department.id)">⋮</button>

                 @if (selectedMenuId === department.id) {
                 <div class="dropdown-menu" (mouseleave)="toggleMenu(department.id)">
                   <button class="menu-item" (click)="onEditDepartment(department)">
                     <span class="btn-icon">✏️</span>
                     Chỉnh sửa
                   </button>
                   <button class="menu-item" (click)="onManagePositions(department)">
                     <span class="btn-icon">👥</span>
                     Quản lý chức vụ
                   </button>
                   <button class="menu-item" (click)="onDeleteDepartment(department)">
                     <span class="btn-icon">🗑️</span>
                     Xóa
                   </button>
                 </div>
                 }
               </div>
             </td>
           </tr>
           }
         </tbody>
       </table>
    } @else {
    <div class="empty-state">
      <span class="empty-icon">🏢</span>
      <p>Chưa có dữ liệu phòng ban.</p>
      <button class="btn btn-primary" (click)="toggleCreateDepartment()">
        <span class="btn-icon">+</span>
        Thêm phòng ban đầu tiên
      </button>
    </div>
    }
  </div>
</div>

<p-confirmdialog />
<app-department-create [isOpen]="isDepartmentCreateOpen" (close)="isDepartmentCreateOpen = false" (createdSuccessfully)="refetchDepartments()"/>
@if(departmentUpdateSelected){
  <app-department-update [department]="departmentUpdateSelected" [isOpen]="isDepartmentUpdateOpen" (close)="onCloseUpdate()" (updatedSuccessfully)="refetchDepartments()"/>
}
@if(departmentPostionSelected){
  <app-department-management-positions [department]="departmentPostionSelected" [isOpen]="isDepartmentPositionOpen" (close)="onClosePostionMangement()"/>
}