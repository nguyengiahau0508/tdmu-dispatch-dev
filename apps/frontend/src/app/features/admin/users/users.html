<div class="users">
  <div class="users__header">
    <div class="header__group">
      <div class="header__title">
        <h2>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
        
      </div>
      <button class="btn btn-primary" (click)="toggleUserCreate()">
        <span class="btn-icon">+</span>
        Th√™m ng∆∞·ªùi d√πng
      </button>
    </div>
    <div class="header__group header__group--block">
      <app-pagination [totalCount]="totalCount || 0" [pageOptions]="pageOptions" (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)" (orderChange)="onOrderChange($event)"></app-pagination>
    </div>
  </div>
  
  <div class="users__main">
    @if (users.length > 0) {
    <table class="users__table">
      <thead>
        <tr>
          <th>ID</th>
          <th>·∫¢nh</th>
          <th>H·ªç v√† t√™n</th>
          <th>Email</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Ng√†y t·∫°o</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (user of users; track user.id) {
        <tr class="user-row">
          <td>{{ user.id }}</td>

          <td class="avatar__cell">
            <div class="avatar__wrapper">
              @if (user.avatarFileId; as avatarId) {
              <app-image-preview [fileId]="avatarId" />
              } @else {
              <img class="avatar__img" src='/icons/account_circle.svg'>
              }
            </div>
          </td>
          <td>
            <div class="user-name">
              <span class="name">{{ user.fullName }}</span>
            </div>
          </td>
          <td>
            <span class="user-email">{{ user.email }}</span>
          </td>
          <td>
            <span class="status-badge" [class]="user.isActive ? 'status-active' : 'status-inactive'">
              {{ user.isActive ? 'Ho·∫°t ƒë·ªông' : 'B·ªã kh√≥a' }}
            </span>
          </td>
          <td>
            {{ user.createdAt | date:'dd/MM/yyyy' }}
          </td>
          <td class="row-actions">
            <div class="actions-menu">
              <button class="menu-button" (click)="toggleMenu(user.id)">‚ãÆ</button>

              @if (selectedMenuId === user.id) {
              <div class="dropdown-menu" (mouseleave)="toggleMenu(user.id)">
                <button class="menu-item" (click)="onViewDetailUser(user)">
                  <span class="btn-icon">üëÅÔ∏è</span>
                  Xem chi ti·∫øt
                </button>
                <button class="menu-item" (click)="onUpdateUser(user)">
                  <span class="btn-icon">‚úèÔ∏è</span>
                  C·∫≠p nh·∫≠t th√¥ng tin
                </button>
                <button class="menu-item" (click)="onBlockUserAccount(user)">
                  <span class="btn-icon">üîí</span>
                  Kh√≥a t√†i kho·∫£n
                </button>
                <button class="menu-item" (click)="onManageUserRole(user)">
                  <span class="btn-icon">üë•</span>
                  Ph√¢n quy·ªÅn
                </button>
                <button class="menu-item" (click)="onManageUserPosition(user)">
                  <span class="btn-icon">üè¢</span>
                  Ch·ª©c danh
                </button>
              </div>
              }
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
    } @else {
    <div class="empty-state">
      <span class="empty-icon">üë•</span>
      <p>Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o.</p>
      <button class="btn btn-primary" (click)="toggleUserCreate()">
        T·∫°o ng∆∞·ªùi d√πng ƒë·∫ßu ti√™n
      </button>
    </div>
    }
  </div>
</div>

<app-user-create [isOpen]="isUserCreateOpen" (close)="isUserCreateOpen = false"
  (createdSuccessfully)="refreshUsers()" />

@if(selectedUser){
<app-user-update [isOpen]="isUserUpdateOpen" [user]="selectedUser" (close)="toggleUserUpdate()"
  (updatedSuccessfully)="onUserUpdated()" />
}

@if(selectedUserRoles){
<app-user-roles [isOpen]="isUserRolesOpen" [user]="selectedUserRoles" (close)="toggleUserRoles()"
  (updated)="onUserRolesUpdated()" />
}

@if(selectedUserPoitions){
<app-user-poitions [userId]="selectedUserPoitions.id" [isOpen]="isUserPoitionsOpen" [user]="selectedUserPoitions" (close)="toggleUserPoitions()"
  (updated)="onUserPoitionsUpdated()" />
}

@if(selectedUserDetailId){
<app-user-detail [isOpen]="isUserDetailOpen" [userId]="selectedUserDetailId" (close)="toggleUserDetail()" />
}
