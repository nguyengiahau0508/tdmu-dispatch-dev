<div class="workflow-steps-manager">
  <!-- Header -->
  <div class="steps-header">
    <h3>Qu·∫£n l√Ω c√°c b∆∞·ªõc trong quy tr√¨nh</h3>
    <button class="btn btn-primary" (click)="toggleAddStep()">
      <span class="btn-icon">+</span>
      Th√™m b∆∞·ªõc m·ªõi
    </button>
  </div>

  <!-- Steps List -->
  <div class="steps-list">
    @if (steps.length > 0) {
      @for (step of steps; track step.id) {
        <div class="step-item">
          <div class="step-content">
            <div class="step-info">
              <div class="step-order">{{ step.orderNumber }}</div>
              <div class="step-details">
                <h4>{{ step.name }}</h4>
                <p>{{ step.description || 'Kh√¥ng c√≥ m√¥ t·∫£' }}</p>
                <div class="step-meta">
                  <span class="step-type">{{ getStepTypeLabel(step.type) }}</span>
                  <span class="step-role">{{ getRoleLabel(step.assignedRole) }}</span>
                </div>
              </div>
            </div>
            <div class="step-actions">
              <button class="btn btn-icon" (click)="editStep(step)" title="Ch·ªânh s·ª≠a">
                <span class="btn-icon">‚úèÔ∏è</span>
              </button>
              <button class="btn btn-icon" (click)="duplicateStep(step)" title="Sao ch√©p">
                <span class="btn-icon">üìã</span>
              </button>
              <button class="btn btn-icon btn-danger" (click)="deleteStep(step)" title="X√≥a">
                <span class="btn-icon">üóëÔ∏è</span>
              </button>
            </div>
          </div>
        </div>
      }
    } @else {
      <div class="empty-state">
        <div class="empty-icon">üìã</div>
        <p>Ch∆∞a c√≥ b∆∞·ªõc n√†o trong quy tr√¨nh n√†y.</p>
        <button class="btn btn-primary" (click)="toggleAddStep()">Th√™m b∆∞·ªõc ƒë·∫ßu ti√™n</button>
      </div>
    }
  </div>

  <!-- Add/Edit Step Modal -->
  @if (isModalOpen) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ isEditing ? 'Ch·ªânh s·ª≠a b∆∞·ªõc' : 'Th√™m b∆∞·ªõc m·ªõi' }}</h3>
          <button class="btn btn-icon" (click)="closeModal()">
            <span class="btn-icon">‚úï</span>
          </button>
        </div>
        
        <form [formGroup]="stepForm" (ngSubmit)="onSubmit()" class="modal-body">
          <div class="form-group">
            <label for="name">T√™n b∆∞·ªõc *</label>
            <input 
              type="text" 
              id="name" 
              formControlName="name" 
              placeholder="Nh·∫≠p t√™n b∆∞·ªõc"
              class="form-control"
            />
            @if (stepForm.get('name')?.invalid && stepForm.get('name')?.touched) {
              <div class="error-message">T√™n b∆∞·ªõc l√† b·∫Øt bu·ªôc</div>
            }
          </div>

          <div class="form-group">
            <label for="description">M√¥ t·∫£</label>
            <textarea 
              id="description" 
              formControlName="description" 
              placeholder="Nh·∫≠p m√¥ t·∫£ b∆∞·ªõc"
              class="form-control"
              rows="3"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="type">Lo·∫°i b∆∞·ªõc *</label>
            <select id="type" formControlName="type" class="form-control">
              <option value="">Ch·ªçn lo·∫°i b∆∞·ªõc</option>
              @for (type of stepTypes; track type.value) {
                <option [value]="type.value">{{ type.label }}</option>
              }
            </select>
            @if (stepForm.get('type')?.invalid && stepForm.get('type')?.touched) {
              <div class="error-message">Lo·∫°i b∆∞·ªõc l√† b·∫Øt bu·ªôc</div>
            }
          </div>

          <div class="form-group">
            <label for="assignedRole">Vai tr√≤ ƒë∆∞·ª£c g√°n *</label>
            <select id="assignedRole" formControlName="assignedRole" class="form-control">
              <option value="">Ch·ªçn vai tr√≤</option>
              @for (role of roles; track role.value) {
                <option [value]="role.value">{{ role.label }}</option>
              }
            </select>
            @if (stepForm.get('assignedRole')?.invalid && stepForm.get('assignedRole')?.touched) {
              <div class="error-message">Vai tr√≤ ƒë∆∞·ª£c g√°n l√† b·∫Øt bu·ªôc</div>
            }
          </div>

          <div class="form-group">
            <label for="orderNumber">Th·ª© t·ª±</label>
            <input 
              type="number" 
              id="orderNumber" 
              formControlName="orderNumber" 
              placeholder="Th·ª© t·ª± b∆∞·ªõc"
              class="form-control"
              min="1"
            />
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="isActive" />
              <span class="checkmark"></span>
              B∆∞·ªõc ƒëang ho·∫°t ƒë·ªông
            </label>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">H·ªßy</button>
            <button type="submit" class="btn btn-primary" [disabled]="stepForm.invalid || isSubmitting">
              {{ isSubmitting ? 'ƒêang x·ª≠ l√Ω...' : (isEditing ? 'C·∫≠p nh·∫≠t' : 'Th√™m') }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
