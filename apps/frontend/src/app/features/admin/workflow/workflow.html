<div class="workflow">
  <div class="workflow__header">
    <div class="header__group header__group--block">
      <div class="header__title">
        <h2>Qu·∫£n l√Ω quy tr√¨nh</h2>
        <button class="btn btn-primary" (click)="toggleWorkflowTemplateCreate()">
          <span class="btn-icon">+</span>
          Th√™m quy tr√¨nh
        </button>
      </div>
    </div>
    <div class="header__group header__group--block">
      <app-pagination [totalCount]="totalCount || 0" [pageOptions]="pageOptions" (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)" (orderChange)="onOrderChange($event)"></app-pagination>
    </div>
  </div>
  
  <div class="workflow__main">
    @if (workflowTemplates.length > 0) {
    <table class="workflow__table">
      <thead>
        <tr>
          <th>ID</th>
          <th>T√™n quy tr√¨nh</th>
          <th>M√¥ t·∫£</th>
          <th>Tr·∫°ng th√°i</th>
          <th>S·ªë b∆∞·ªõc</th>
          <th>Ng∆∞·ªùi t·∫°o</th>
          <th>Ng√†y t·∫°o</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (workflowTemplate of workflowTemplates; track workflowTemplate.id) {
        <tr class="workflow-row">
          <td>{{ workflowTemplate.id }}</td>
          <td>
            <div class="workflow-name">
              <span class="name">{{ workflowTemplate.name }}</span>
            </div>
          </td>
          <td>
            <span class="description">{{ workflowTemplate.description || 'Kh√¥ng c√≥ m√¥ t·∫£' }}</span>
          </td>
          <td>
            <span class="status-badge" [class]="getStatusClass(workflowTemplate.isActive)">
              {{ getStatusLabel(workflowTemplate.isActive) }}
            </span>
          </td>
          <td>
            <span class="steps-count">{{ workflowTemplate.steps.length || 0 }} b∆∞·ªõc</span>
          </td>
          <td>
            <span class="creator">{{ workflowTemplate.createdByUser.fullName || 'N/A' }}</span>
          </td>
          <td>{{ workflowTemplate.createdAt | date:'dd/MM/yyyy' }}</td>
          <td class="row-actions">
            <div class="actions-menu">
              <button class="menu-button" (click)="toggleMenu(workflowTemplate.id)">‚ãÆ</button>

              @if (selectedMenuId === workflowTemplate.id) {
              <div class="dropdown-menu" (mouseleave)="toggleMenu(workflowTemplate.id)">
                <button class="menu-item" (click)="viewWorkflowTemplateDetail(workflowTemplate)">
                  <span class="btn-icon">üëÅÔ∏è</span>
                  Xem chi ti·∫øt
                </button>
                <button class="menu-item" (click)="editWorkflowTemplate(workflowTemplate)">
                  <span class="btn-icon">‚úèÔ∏è</span>
                  Ch·ªânh s·ª≠a
                </button>
                <button class="menu-item menu-item--danger" (click)="deleteWorkflowTemplate(workflowTemplate)">
                  <span class="btn-icon">üóëÔ∏è</span>
                  X√≥a
                </button>
              </div>
              }
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
    } @else {
    <div class="empty-state">
      <span class="empty-icon">üìã</span>
      <p>Ch∆∞a c√≥ quy tr√¨nh n√†o ƒë∆∞·ª£c t·∫°o.</p>
      <button class="btn btn-primary" (click)="toggleWorkflowTemplateCreate()">
        T·∫°o quy tr√¨nh ƒë·∫ßu ti√™n
      </button>
    </div>
    }
  </div>
</div>

<!-- Workflow Template Create Modal -->
@if (isWorkflowTemplateCreateOpen) {
<app-workflow-template-create 
  [isOpen]="isWorkflowTemplateCreateOpen" 
  (closeModal)="toggleWorkflowTemplateCreate()"
  (createdSuccessfully)="onWorkflowTemplateCreated()" />
}

<!-- Workflow Template Update Modal -->
@if (isWorkflowTemplateUpdateOpen && selectedWorkflowTemplate) {
<app-workflow-template-update 
  [isOpen]="isWorkflowTemplateUpdateOpen" 
  [workflowTemplate]="selectedWorkflowTemplate"
  (closeModal)="toggleWorkflowTemplateUpdate()"
  (updatedSuccessfully)="onWorkflowTemplateUpdated()" />
}

<!-- Workflow Template Detail Modal -->
@if (isWorkflowTemplateDetailOpen && selectedWorkflowTemplate) {
<app-workflow-template-detail 
  [isOpen]="isWorkflowTemplateDetailOpen" 
  [workflowTemplateId]="selectedWorkflowTemplate.id"
  (closeModal)="onWorkflowTemplateDetailClosed()" />
}
